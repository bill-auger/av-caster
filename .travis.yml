language: cpp
compiler: gcc
sudo:     required
dist:     bionic

git:
  depth: 1

branches:
  except: master

notifications:
  email: false
  irc:
    channels:
    on_success: always
    on_failure: always
    on_start:   never
  webhooks:
    urls: https://webhooks.gitter.im/e/1fcf27221a4243f787d8
    on_success: always
    on_failure: always
    on_start:   never

addons:
  coverity_scan:
    project:
      name: "bill-auger/av-caster"
      description: "A light-weight native gStreamer GUI for screencast, webcam, and audio recording and streaming"
    build_command: "make CONFIG=Release"
    branch_pattern: development


before_install:
  - BIN_NAME='av-caster'
  - DEPS='libfreetype6-dev libgstreamer-plugins-base1.0-dev libircclient-dev
          libx11-dev libxcursor-dev libxinerama-dev libxrandr-dev'
  - BUILD_DIR=$TRAVIS_BUILD_DIR/Builds/Makefile
  - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-

install:
  - echo "preparing build environment"
  - sudo apt-get -qq update
  - sudo apt-get -y  install $DEPS

script:
  - echo "building 64-bit $BIN_NAME"
  - cd $BUILD_DIR
  - make CONFIG=Release
  - make DESTDIR=$BUILD_DIR/destdir PREFIX=prefix install

after_script:
  - echo "verifying build"
  - [[ -x $BUILD_DIR/build/$BIN_NAME              ]]
  - [[ -x $BUILD_DIR/destdir/prefix/bin/$BIN_NAME ]]
